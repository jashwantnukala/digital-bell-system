<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Manage Announcements ‚Äî Teacher</title>

  <style>
    :root {
      --accent: #2d66ff;
      --danger: #ff3b30;
      --card: rgba(255,255,255,0.65);
      --blur: blur(22px);
      --muted: #6b7280;
      --text-dark: #1f2937;
    }

    body {
      margin: 0;
      font-family: "Inter", sans-serif;
      background: linear-gradient(135deg, #dce7ff, #eef3ff, #ffffff);
      padding: 40px 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      color: var(--text-dark);
    }

    /* HEADER */
    .nav {
      width: 95%;
      max-width: 950px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .nav h1 {
      margin: 0;
      font-size: 30px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* BUTTONS */
    button {
      cursor: pointer;
      border: none;
      border-radius: 12px;
      padding: 10px 18px;
      font-weight: 600;
      transition: 0.2s;
    }

    #signOutBtn {
      background: var(--danger);
      color: white;
      box-shadow: 0 4px 12px rgba(255, 59, 48, 0.3);
    }
    #signOutBtn:hover {
      filter: brightness(1.1);
    }

    /* CARD CONTAINER */
    .card {
      width: 95%;
      max-width: 950px;
      background: var(--card);
      backdrop-filter: var(--blur);
      border-radius: 20px;
      padding: 25px;
      margin-top: 25px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.1);
    }

    .card h2 {
      font-size: 21px;
      font-weight: 600;
      margin-top: 0;
      margin-bottom: 14px;
    }

    /* INPUTS */
    input, textarea {
      width: 100%;
      font-size: 16px;
      padding: 14px;
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,0.15);
      margin-bottom: 12px;
      transition: 0.25s;
    }

    input:focus, textarea:focus {
      border-color: var(--accent);
      outline: none;
      box-shadow: 0 0 0 3px rgba(45,102,255,0.2);
    }

    textarea { min-height: 100px; resize: vertical; }

    /* POST BUTTON */
    .primary {
      background: var(--accent);
      color: white;
      font-size: 16px;
      padding: 12px 20px;
      border-radius: 14px;
      box-shadow: 0 4px 12px rgba(45,102,255,0.3);
      transition: 0.2s;
    }
    .primary:hover {
      filter: brightness(1.08);
      transform: translateY(-1px);
    }

    /* ANNOUNCEMENT BOX */
    .ann {
      background: white;
      padding: 18px;
      border-radius: 14px;
      margin-bottom: 15px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.06);
      display: flex;
      justify-content: space-between;
      gap: 14px;
      border-left: 5px solid var(--accent);
      transition: 0.2s;
    }
    .ann:hover {
      transform: translateY(-2px);
    }

    .small-btn {
      padding: 8px 14px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: 0.2s;
    }

    .edit { background: #fff7c2; }
    .delete { background: #ffd1d1; }

    .edit:hover { filter: brightness(1.05); }
    .delete:hover { filter: brightness(1.07); }

    .meta {
      font-size: 13px;
      margin-top: 4px;
      color: var(--muted);
    }

    /* SUCCESS TOAST */
    #successToast {
      position: fixed;
      bottom: 28px;
      right: 28px;
      background: var(--accent);
      color: white;
      padding: 14px 20px;
      border-radius: 14px;
      font-size: 15px;
      opacity: 0;
      box-shadow: 0 6px 18px rgba(0,0,0,0.15);
      transform: translateY(20px);
      transition: 0.4s ease;
      pointer-events: none;
    }
    #successToast.show {
      opacity: 1;
      transform: translateY(0);
    }

    a.home {
      margin-top: 18px;
      text-decoration: none;
      font-weight: 600;
      color: var(--accent);
      font-size: 16px;
    }
  </style>
</head>

<body>

  <div class="nav">
    <h1>üì£ Manage Announcements</h1>
    <button id="signOutBtn">Sign Out</button>
  </div>

  <div class="card">
    <h2>Post New Announcement</h2>
    <input id="title" placeholder="Title">
    <textarea id="message" placeholder="Write message..."></textarea>
    <button class="primary" id="postBtn">Post Announcement</button>
  </div>

  <div class="card">
    <h2>All Announcements</h2>
    <div id="annList">Loading...</div>
  </div>

  <a href="index-teacher.html" class="home">‚Üê Back to Home</a>

  <div id="successToast">Announcement posted ‚úîÔ∏è</div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <script>
    const firebaseConfig = {
      apiKey:"AIzaSyB3Lv_9EiVBVy5aXwiYOn0pgZu31ykFOGM",
      authDomain:"digitalbellplisworkthistime.firebaseapp.com",
      databaseURL:"https://digitalbellplisworkthistime-default-rtdb.firebaseio.com",
      projectId:"digitalbellplisworkthistime",
      storageBucket:"digitalbellplisworkthistime.firebasestorage.app",
      messagingSenderId:"829189847707",
      appId:"1:829189847707:web:99b13d5fe551b54d9ce43e"
    };
    firebase.initializeApp(firebaseConfig);

    const db = firebase.database();
    const auth = firebase.auth();

    const adminUID = "lPvZ7WGuTVP1LcYvKjGYtOj1GBD3";

    auth.onAuthStateChanged(user => {
      if (!user || user.uid !== adminUID) location.href = "index.html";
    });

    document.getElementById("signOutBtn").onclick =
      () => auth.signOut().then(() => location.href = "index.html");

    function showToast() {
      const t = document.getElementById("successToast");
      t.classList.add("show");
      setTimeout(() => t.classList.remove("show"), 2000);
    }

    document.getElementById("postBtn").onclick = () => {
      const t = document.getElementById("title").value.trim();
      const m = document.getElementById("message").value.trim();

      if (!t || !m) return alert("Fill all fields");

      db.ref("announcements").push({
        title: t,
        message: m,
        timestamp: Date.now(),
        postedBy: auth.currentUser.email
      });

      showToast();
      document.getElementById("title").value = "";
      document.getElementById("message").value = "";
    };

    db.ref("announcements")
      .orderByChild("timestamp")
      .on("value", snap => {
        const box = document.getElementById("annList");
        box.innerHTML = "";

        if (!snap.exists()) {
          box.innerHTML = `<div style="color:#666">No announcements.</div>`;
          return;
        }

        const arr = [];
        snap.forEach(s => arr.push({ id:s.key, ...s.val() }));
        arr.reverse();

        arr.forEach(a => {
          box.insertAdjacentHTML("beforeend", `
            <div class="ann">
              <div>
                <h3>${escapeHtml(a.title)}</h3>
                <p>${escapeHtml(a.message)}</p>
                <div class="meta">
                  Posted by ${escapeHtml(a.postedBy)} ¬∑ ${new Date(a.timestamp).toLocaleString()}
                </div>
              </div>

              <div>
                <button class="small-btn edit" onclick="editAnn('${a.id}')">Edit</button>
                <button class="small-btn delete" onclick="delAnn('${a.id}')">Delete</button>
              </div>
            </div>
          `);
        });
      });

    function editAnn(id) {
      db.ref("announcements/"+id).once("value").then(s => {
        const v = s.val();
        const nt = prompt("Edit title:", v.title);
        if (nt === null) return;

        const nm = prompt("Edit message:", v.message);
        if (nm === null) return;

        db.ref("announcements/"+id).update({
          title: nt,
          message: nm,
          editedAt: Date.now()
        });
      });
    }

    function delAnn(id) {
      if (confirm("Delete this announcement?"))
        db.ref("announcements/"+id).remove();
    }

    function escapeHtml(t) {
      return String(t ?? "")
        .replace(/[&<>]/g, c => ({ "&":"&amp;","<":"&lt;"," >":"&gt;" }[c]));
    }
  </script>

</body>
</html>
