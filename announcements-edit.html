<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ””</text></svg>">
Â  <meta charset="utf-8" />
Â  <meta name="viewport" content="width=device-width,initial-scale=1" />
Â  <title>Announcements â€” Teacher</title>
Â  <style>
Â  Â  :root { --card-bg: rgba(255,255,255,0.55); --accent:#007aff; --danger:#ff3b30; --muted:#666; }
Â  Â  body { margin:0; font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Inter", sans-serif;
Â  Â  Â  Â  Â  Â background: linear-gradient(135deg,#eef7ff,#ffffff); padding:28px 12px; display:flex; flex-direction:column; align-items:center; }
Â  Â  .nav { width:90%; max-width:900px; display:flex; justify-content:space-between; align-items:center; margin-bottom:18px; }
Â  Â  .nav h1 { margin:0; font-size:22px; font-weight:600; display:flex; gap:10px; align-items:center; }
Â  Â  .nav button { padding:10px 14px; border-radius:10px; border:none; cursor:pointer; background:var(--danger); color:white; }
Â  Â  .card { width:90%; max-width:900px; background:var(--card-bg); backdrop-filter:blur(22px); border-radius:18px; padding:18px; box-shadow:0 8px 30px rgba(0,0,0,0.08); }
Â  Â  .form-row { display:flex; gap:12px; margin-bottom:12px; }
Â  Â  input, textarea { width:100%; padding:12px; border-radius:10px; border:1px solid rgba(0,0,0,0.12); font-size:15px; }
Â  Â  textarea { resize:vertical; min-height:86px; }
Â  Â  .controls { display:flex; gap:12px; margin-top:8px; }
Â  Â  .btn { padding:10px 16px; border-radius:12px; border:none; cursor:pointer; background:rgba(255,255,255,0.6); }
Â  Â  .btn.primary { background:var(--accent); color:white; }
Â  Â  .list { margin-top:18px; }
Â  Â  .ann { background:rgba(255,255,255,0.9); padding:14px; border-radius:12px; margin-bottom:12px; display:flex; justify-content:space-between; align-items:flex-start; box-shadow:0 6px 18px rgba(0,0,0,0.04); }
Â  Â  .ann-details { max-width:76%; }
Â  Â  .ann h3 { margin:0 0 6px 0; font-size:16px; }
Â  Â  .ann p { margin:0; color:#222; }
Â  Â  .ann .meta { color:var(--muted); font-size:13px; margin-top:8px; }
Â  Â  .ann-actions { display:flex; gap:8px; align-items:center; }
Â  Â  .small { padding:8px 10px; border-radius:8px; border:none; cursor:pointer; }
Â  Â  .small.edit { background:#ffd; }
Â  Â  .small.delete { background:#ffb3b3; }
Â  Â  a.home { margin-top:14px; color:var(--accent); text-decoration:none; font-weight:500; display:inline-block; }
Â  </style>
</head>
<body>

Â  <div class="nav">
Â  Â  <h1>ğŸ“£ Announcements â€” Manage</h1>
Â  Â  <button id="signOutBtn">Sign out</button>
Â  </div>

Â  <div class="card">
Â  Â  <div style="font-weight:600; margin-bottom:10px;">Post New Announcement</div>
Â  Â  <div class="form-row">
Â  Â  Â  <input id="title" placeholder="Title (short)" />
Â  Â  </div>
Â  Â  <div class="form-row">
Â  Â  Â  <textarea id="message" placeholder="Write message..."></textarea>
Â  Â  </div>
Â  Â  <div class="controls">
Â  Â  Â  <button class="btn primary" id="postBtn">Post Announcement</button>
Â  Â  Â  <button class="btn" id="clearBtn">Clear</button>
Â  Â  </div>
Â  </div>

Â  <div class="card list" style="margin-top:16px;">
Â  Â  <div style="font-weight:600; margin-bottom:12px;">All Announcements</div>
Â  Â  <div id="annList">Loading...</div>
Â  </div>

Â  <a class="home" href="index-teacher.html">â† Back to Home</a>

Â  Â  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
Â  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
Â  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

Â  <script>
Â  Â  const firebaseConfig = {
Â  Â  Â  apiKey: "AIzaSyB3Lv_9EiVBVy5aXwiYOn0pgZu31ykFOGM",
Â  Â  Â  authDomain: "digitalbellplisworkthistime.firebaseapp.com",
Â  Â  Â  databaseURL: "https://digitalbellplisworkthistime-default-rtdb.firebaseio.com",
Â  Â  Â  projectId: "digitalbellplisworkthistime",
Â  Â  Â  storageBucket: "digitalbellplisworkthistime.firebasestorage.app",
Â  Â  Â  messagingSenderId: "829189847707",
Â  Â  Â  appId: "1:829189847707:web:99b13d5fe551b54d9ce43e",
Â  Â  Â  measurementId: "G-W0PYZY1R1M"
Â  Â  };

Â  Â  firebase.initializeApp(firebaseConfig);
Â  Â  const db = firebase.database();
Â  Â  const auth = firebase.auth();

Â  Â  const adminUID = "lPvZ7WGuTVP1LcYvKjGYtOj1GBD3";

Â  Â  // Auth guard
Â  Â  auth.onAuthStateChanged(user => {
Â  Â  Â  if (!user || user.uid !== adminUID) {
Â  Â  Â  Â  alert("Access denied.");
Â  Â  Â  Â  window.location.href = "index.html";
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  // Load announcements once authenticated
Â  Â  Â  setupAnnouncementListener();
Â  Â  });

Â  Â  document.getElementById('signOutBtn').onclick = () =>
Â  Â  Â  auth.signOut().then(() => window.location.href = 'index.html');


Â  Â  // Listen for realtime changes (ONE LISTENER ONLY)
Â  Â  function setupAnnouncementListener() {
Â  Â  Â  const container = document.getElementById('annList');
Â  Â  Â  container.innerHTML = "Loading...";

Â  Â  Â  db.ref("announcements").orderByChild("timestamp").on("value", snap => {
Â  Â  Â  Â  container.innerHTML = "";

Â  Â  Â  Â  if (!snap.exists()) {
Â  Â  Â  Â  Â  container.innerHTML = "<div style='color:#666'>No announcements yet.</div>";
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  const entries = [];
Â  Â  Â  Â  snap.forEach(s => entries.push({ id: s.key, ...s.val() }));
Â  Â  Â  Â  entries.reverse(); // newest first

Â  Â  Â  Â  entries.forEach(e => {
Â  Â  Â  Â  Â  const date = new Date(e.timestamp || Date.now()).toLocaleString();
Â  Â  Â  Â  Â  const postedBy = e.postedBy || "Teacher";
Â  Â  Â  Â  Â  const html = document.createElement("div");
Â  Â  Â  Â  Â  html.className = "ann";
Â  Â  Â  Â  Â  html.innerHTML = `
Â  Â  Â  Â  Â  Â  <div class="ann-details">
Â  Â  Â  Â  Â  Â  Â  <h3>${escapeHtml(e.title)}</h3>
Â  Â  Â  Â  Â  Â  Â  <p>${escapeHtml(e.message)}</p>
Â  Â  Â  Â  Â  Â  Â  <div class="meta">Posted by ${escapeHtml(postedBy)} â€¢ ${date}</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="ann-actions">
Â  Â  Â  Â  Â  Â  Â  <button class="small edit" onclick="editAnnouncement('${e.id}')">Edit</button>
Â  Â  Â  Â  Â  Â  Â  <button class="small delete" onclick="deleteAnnouncement('${e.id}', '${escapeJs(e.title)}')">Delete</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  container.appendChild(html);
Â  Â  Â  Â  });
Â  Â  Â  });
Â  Â  }


Â  Â  // Post announcement
Â  Â  document.getElementById("postBtn").onclick = () => {
Â  Â  Â  const title = document.getElementById("title").value.trim();
Â  Â  Â  const message = document.getElementById("message").value.trim();
Â  Â  Â  if (!title || !message) { alert("Fill both fields"); return; }

Â  Â  Â  const payload = {
Â  Â  Â  Â  title,
Â  Â  Â  Â  message,
Â  Â  Â  Â  timestamp: Date.now(),
Â  Â  Â  Â  postedBy: auth.currentUser.email
Â  Â  Â  };

Â  Â  Â  db.ref("announcements").push(payload).then(() => {
Â  Â  Â  Â  document.getElementById("title").value = "";
Â  Â  Â  Â  document.getElementById("message").value = "";
Â  Â  Â  });
Â  Â  };

Â  Â  document.getElementById("clearBtn").onclick = () => {
Â  Â  Â  document.getElementById("title").value = "";
Â  Â  Â  document.getElementById("message").value = "";
Â  Â  };


Â  Â  function deleteAnnouncement(id, titleSafe) {
Â  Â  Â  if (!confirm("Delete announcement: " + titleSafe + "?")) return;

Â  Â  Â  db.ref("announcements/" + id).remove();
Â  Â  }

Â  Â  function editAnnouncement(id) {
Â  Â  Â  db.ref("announcements/" + id).once("value").then(snap => {
Â  Â  Â  Â  const val = snap.val();
Â  Â  Â  Â  if (!val) return;

Â  Â  Â  Â  const newTitle = prompt("Edit title", val.title);
Â  Â  Â  Â  if (newTitle === null) return;
Â  Â  Â  Â  const newMessage = prompt("Edit message", val.message);
Â  Â  Â  Â  if (newMessage === null) return;

Â  Â  Â  Â  db.ref("announcements/" + id).update({
Â  Â  Â  Â  Â  title: newTitle,
Â  Â  Â  Â  Â  message: newMessage,
Â  Â  Â  Â  Â  editedAt: Date.now()
Â  Â  Â  Â  });
Â  Â  Â  });
Â  Â  }

Â  Â  function escapeHtml(s) {
Â  Â  Â  return String(s)
Â  Â  Â  Â  .replace(/&/g, "&amp;")
Â  Â  Â  Â  .replace(/</g, "&lt;")
Â  Â  Â  Â  .replace(/>/g, "&gt;");
Â  Â  }

Â  Â  function escapeJs(s) {
Â  Â  Â  return String(s)
Â  Â  Â  Â  .replace(/'/g, "\\'")
Â  Â  Â  Â  .replace(/"/g, '\\"');
Â  Â  }
</script>

</body>
</html>
