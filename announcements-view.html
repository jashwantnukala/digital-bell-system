<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Announcements ‚Äî Student</title>
  <style>
    /* Apple-style, minimal, rounded cards */
    :root { --card-bg: rgba(255,255,255,0.55); --accent: #007aff; --muted:#666; }
    body {
      margin:0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Inter", sans-serif;
      background: linear-gradient(135deg,#dbe8ff,#eef3ff); min-height:100vh;
      display:flex; flex-direction:column; align-items:center; padding:36px 12px;
    }
    h1 { margin:0; font-size:28px; font-weight:600; display:flex; align-items:center; gap:10px; }
    h1::before { content:"üì¢"; font-size:28px; }
    .card { width:90%; max-width:900px; margin-top:28px; background:var(--card-bg);
            backdrop-filter: blur(20px); border-radius:18px; padding:20px; box-shadow:0 8px 30px rgba(0,0,0,0.08);}
    .ann { background:rgba(255,255,255,0.85); border-radius:12px; padding:14px; margin-bottom:12px;
          box-shadow:0 6px 18px rgba(0,0,0,0.04); }
    .ann h3 { margin:0 0 6px 0; font-size:17px; }
    .ann p { margin:4px 0; color:#1d1d1f; font-size:15px; line-height:1.35; }
    .timestamp { color:var(--muted); font-size:13px; margin-top:8px; }
    a.home { margin-top:18px; color:var(--accent); text-decoration:none; font-weight:500; display:inline-block; }
    .empty { color:var(--muted); padding:14px; text-align:center; }
  </style>
</head>
<body>
  <h1>Announcements</h1>

  <div class="card" id="annCard">
    <div id="annList" class="loading">
      Loading announcements...
    </div>
  </div>

  <a class="home" href="index-student.html">‚Üê Back to Home</a>

  <!-- Firebase v8 CDN -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <script>
    // --- Your Firebase config (uses your provided values) ---
    const firebaseConfig = {
      apiKey: "AIzaSyB3Lv_9EiVBVy5aXwiYOn0pgZu31ykFOGM",
      authDomain: "digitalbellplisworkthistime.firebaseapp.com",
      databaseURL: "https://digitalbellplisworkthistime-default-rtdb.firebaseio.com",
      projectId: "digitalbellplisworkthistime",
      storageBucket: "digitalbellplisworkthistime.firebasestorage.app",
      messagingSenderId: "829189847707",
      appId: "1:829189847707:web:99b13d5fe551b54d9ce43e",
      measurementId: "G-W0PYZY1R1M"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Load announcements (newest first)
    function loadAnnouncements() {
      const container = document.getElementById('annList');
      container.innerHTML = 'Loading announcements...';
      db.ref('announcements').orderByChild('timestamp').once('value', snap => {
        container.innerHTML = '';
        if (!snap.exists()) {
          container.innerHTML = '<div class="empty">No announcements yet.</div>';
          return;
        }
        // snapshot -> array of entries newest first
        const entries = [];
        snap.forEach(s => entries.push({ id: s.key, ...s.val() }));
        entries.reverse(); // newest first
        entries.forEach(e => {
          const d = new Date(e.timestamp || Date.now()).toLocaleString();
          const html = `
            <div class="ann">
              <h3>${escapeHtml(e.title || 'Untitled')}</h3>
              <p>${escapeHtml(e.message || '')}</p>
              <div class="timestamp">Posted by ${escapeHtml(e.postedBy || 'Teacher')} ‚Ä¢ ${d}</div>
            </div>`;
          container.insertAdjacentHTML('beforeend', html);
        });
      });
    }

    // defensive simple html escape
    function escapeHtml(s) {
      return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
    }

    loadAnnouncements();

    // realtime update subscription (optional live updates)
    db.ref('announcements').orderByChild('timestamp').on('value', () => loadAnnouncements());
  </script>
</body>
</html>
